<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>è©©æ­Œæœ—è®€ - äº’å‹•èªéŸ³ï¼ˆå¹³æ¿ä¿®æ­£ç‰ˆï¼‹ã€Œé•·ã€è®€éŸ³èª¿æ•´ï¼‰</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

body{
  font-family:'Noto Sans TC',sans-serif;
  -webkit-touch-callout:none;-webkit-user-select:none;user-select:none;
  touch-action:manipulation;overflow-x:hidden;
  min-height:100vh;min-height:-webkit-fill-available;
}
html{height:-webkit-fill-available;}
.gradient-bg{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);}
.poem-line{transition:.3s;cursor:pointer;position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent}
.poem-line:hover,.poem-line:active,.poem-line.touch-active{transform:translateY(-2px);box-shadow:0 8px 25px rgba(59,130,246,.3)}
.poem-line.speaking{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:#fff;transform:scale(1.02);box-shadow:0 10px 30px rgba(59,130,246,.4)}
.wave-animation{position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .6s}
.poem-line.speaking .wave-animation{left:100%}
.speaker-icon{transition:.3s;opacity:.7;pointer-events:none}
.poem-line:hover .speaker-icon,.poem-line.speaking .speaker-icon,.poem-line.touch-active .speaker-icon{opacity:1;transform:scale(1.1)}
.character{position:relative;z-index:10;-webkit-tap-highlight-color:transparent}
.character:active,.character.touch-active{background:#3b82f6!important;color:#fff!important;transform:scale(1.2)!important;box-shadow:0 0 20px rgba(59,130,246,.6)!important}
.control-btn{transition:.3s;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-height:44px;min-width:44px}
.control-btn:hover,.control-btn:active{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.2)}
.quiz-option{touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-height:60px}
.quiz-option:active{transform:scale(.98);background:#dbeafe!important}
.voice-option{touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-height:44px;min-width:44px}

/* å¹³æ¿ */
@media (max-width:1024px) and (min-width:768px){
  .poem-line{padding:2rem;margin-bottom:1rem}
  .character{padding:.75rem;margin:.25rem;font-size:1.5rem;min-width:3rem;min-height:3rem;display:inline-flex;align-items:center;justify-content:center}
  .control-btn{padding:1rem 1.5rem;font-size:1.1rem}
  .speaker-icon{width:2.5rem;height:2.5rem;opacity:1}
}

/* æ‰‹æ©Ÿ */
@media (max-width:767px){
  body{padding:.5rem}
  .character{padding:.4rem;margin:.1rem;min-width:2.2rem;min-height:2.2rem;display:inline-flex;align-items:center;justify-content:center;font-size:1rem}
  .poem-line{padding:1rem;margin-bottom:.75rem}
  .poem-line .text-3xl,.poem-line .text-2xl,.poem-line .text-xl{font-size:1.25rem!important}
  .poem-line .text-4xl{font-size:1.5rem!important}
  .poem-line .text-5xl{font-size:1.75rem!important}
  .speaker-icon{opacity:1;width:1.5rem;height:1.5rem}
  .control-btn{padding:.75rem 1rem;font-size:.875rem}
  .quiz-option{padding:.75rem;min-height:50px}
  h1{font-size:1.25rem!important;text-align:center;margin-bottom:1rem}
  .max-w-4xl{max-width:100%}
}

/* æ©«å‘æé†’ï¼ˆå¯ä¿ç•™ä¹Ÿå¯ç§»é™¤ï¼‰ */
@media screen and (orientation:landscape) and (max-width:1024px){
  body::before{
    content:"è«‹å°‡è¨­å‚™è½‰ç‚ºç›´ç«‹æ¨¡å¼ä»¥ç²å¾—æœ€ä½³é«”é©—";
    position:fixed;inset:0;background:rgba(0,0,0,.9);color:#fff;display:flex;align-items:center;justify-content:center;z-index:9999;font-size:1.2rem;text-align:center;padding:2rem;
  }
}

/* å•Ÿå‹•èªéŸ³æµ®å±¤ */
#voiceGate{
  position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:10000;
}
#voiceGate .card{
  background:#fff;border-radius:1rem;max-width:22rem;width:90%;padding:1.25rem;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.35)
}
</style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
  <!-- ä¸€æ¬¡æ€§å•Ÿå‹•èªéŸ³æµ®å±¤ï¼ˆå¹³æ¿/æ‰‹æ©Ÿç¬¬ä¸€æ¬¡å¿…é ˆé»ä¸€ä¸‹ï¼‰ -->
  <div id="voiceGate">
    <div class="card">
      <div class="text-2xl font-bold mb-2">ğŸ”Š å•Ÿå‹•èªéŸ³</div>
      <p class="text-gray-600 mb-4">åœ¨ iPad / Android å¹³æ¿ä¸Šï¼Œé¦–æ¬¡ä½¿ç”¨éœ€è¦é»ä¸€ä¸‹æŒ‰éˆ•ä»¥å•Ÿå‹•èªéŸ³å¼•æ“ã€‚</p>
      <button id="btnUnlockAudio" class="control-btn bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-full font-medium w-full">
        å…è¨±ä¸¦å•Ÿå‹•èªéŸ³
      </button>
      <p class="text-xs text-gray-500 mt-3">è‹¥æœªå‡ºç¾æ­¤æç¤ºï¼Œä»£è¡¨å·²è‡ªå‹•å•Ÿå‹•ã€‚</p>
    </div>
  </div>

  <div class="max-w-4xl w-full">
    <!-- æ¨™é¡Œèˆ‡æ§åˆ¶å€åŸŸ -->
    <div class="flex flex-col lg:flex-row items-center justify-between gap-6 mb-8">
      <h1 class="text-2xl lg:text-3xl font-bold text-white drop-shadow-lg whitespace-nowrap">
        åœ‹ç«‹è‹—æ —ç‰¹æ®Šæ•™è‚²å­¸æ ¡æ ¡æ­Œ
      </h1>

      <!-- èªéŸ³è¨­å®š -->
      <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-3 shadow-lg">
        <div class="flex items-center gap-4">
          <span class="text-gray-700 font-medium text-xs">èªéŸ³ï¼š</span>
          <div class="flex gap-1">
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="voice" value="female" checked class="sr-only" />
              <div class="voice-option bg-pink-100 hover:bg-pink-200 text-pink-700 px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 border-2 border-pink-300">
                ğŸ‘©å¥³ç”Ÿ
              </div>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="voice" value="male" class="sr-only" />
              <div class="voice-option bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 border-2 border-transparent">
                ğŸ‘¨ç”·ç”Ÿ
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- æ§åˆ¶æŒ‰éˆ• -->
      <div class="flex gap-3">
        <button id="playAll" class="control-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2.5 rounded-full text-sm font-medium flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/></svg>
          æ’­æ”¾å…¨éƒ¨
        </button>
        <button id="stopAll" class="control-btn bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-full text-sm font-medium flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 01-1-1H8z" clip-rule="evenodd"/></svg>
          åœæ­¢æ’­æ”¾
        </button>
      </div>
    </div>

    <!-- ç¬¬ä¸€é  -->
    <div id="page1" class="page bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 md:p-12">
      <div class="space-y-8">
        <div class="poem-line bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border-l-4 border-blue-400 flex items-center justify-between group" data-text="åŒ—å‹¢æ©‹é ­é£„æ›¸é¦™">
          <div class="text-3xl md:text-4xl lg:text-5xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="åŒ—">åŒ—</span>
            <span class="character px-2 py-1 rounded" data-char="å‹¢">å‹¢</span>
            <span class="character px-2 py-1 rounded" data-char="æ©‹">æ©‹</span>
            <span class="character px-2 py-1 rounded" data-char="é ­">é ­</span>
            <span class="character px-2 py-1 rounded" data-char="é£„">é£„</span>
            <span class="character px-2 py-1 rounded" data-char="æ›¸">æ›¸</span>
            <span class="character px-2 py-1 rounded" data-char="é¦™">é¦™</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>

        <div class="poem-line bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-l-4 border-purple-400 flex items-center justify-between group" data-text="å¾Œé¾æºªç•”æ­Œè²å–¨">
          <div class="text-3xl md:text-4xl lg:text-5xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="å¾Œ">å¾Œ</span>
            <span class="character px-2 py-1 rounded" data-char="é¾">é¾</span>
            <span class="character px-2 py-1 rounded" data-char="æºª">æºª</span>
            <span class="character px-2 py-1 rounded" data-char="ç•”">ç•”</span>
            <span class="character px-2 py-1 rounded" data-char="æ­Œ">æ­Œ</span>
            <span class="character px-2 py-1 rounded" data-char="è²">è²</span>
            <span class="character px-2 py-1 rounded" data-char="å–¨">å–¨</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-purple-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>

        <div class="poem-line bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border-l-4 border-green-400 flex items-center justify-between group" data-text="é€™è£¡æ˜¯æˆ‘å€‘æˆé•·çš„æ–ç±ƒ">
          <div class="text-2xl md:text-3xl lg:text-4xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="é€™">é€™</span>
            <span class="character px-2 py-1 rounded" data-char="è£¡">è£¡</span>
            <span class="character px-2 py-1 rounded" data-char="æ˜¯">æ˜¯</span>
            <span class="character px-2 py-1 rounded" data-char="æˆ‘">æˆ‘</span>
            <span class="character px-2 py-1 rounded" data-char="å€‘">å€‘</span>
            <span class="character px-2 py-1 rounded" data-char="æˆ">æˆ</span>
            <span class="character px-2 py-1 rounded" data-char="é•·">é•·</span>
            <span class="character px-2 py-1 rounded" data-char="çš„">çš„</span>
            <span class="character px-2 py-1 rounded" data-char="æ–">æ–</span>
            <span class="character px-2 py-1 rounded" data-char="ç±ƒ">ç±ƒ</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>

        <div class="poem-line bg-gradient-to-r from-orange-50 to-red-50 p-6 rounded-xl border-l-4 border-orange-400 flex items-center justify-between group" data-text="æ´‹æº¢è‘—æ„›çš„èŠ¬èŠ³">
          <div class="text-3xl md:text-4xl lg:text-5xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="æ´‹">æ´‹</span>
            <span class="character px-2 py-1 rounded" data-char="æº¢">æº¢</span>
            <span class="character px-2 py-1 rounded" data-char="è‘—">è‘—</span>
            <span class="character px-2 py-1 rounded" data-char="æ„›">æ„›</span>
            <span class="character px-2 py-1 rounded" data-char="çš„">çš„</span>
            <span class="character px-2 py-1 rounded" data-char="èŠ¬">èŠ¬</span>
            <span class="character px-2 py-1 rounded" data-char="èŠ³">èŠ³</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>
      </div>
    </div>

    <!-- ç¬¬äºŒé  -->
    <div id="page2" class="page bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 md:p-12 hidden">
      <div class="space-y-8">
        <div class="poem-line bg-gradient-to-r from-teal-50 to-cyan-50 p-6 rounded-xl border-l-4 border-teal-400 flex items-center justify-between group" data-text="è‚¯å®šè‡ªæˆ‘ï¼Œæ’é™¤è¬é›£">
          <div class="text-2xl md:text-3xl lg:text-4xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="è‚¯">è‚¯</span>
            <span class="character px-2 py-1 rounded" data-char="å®š">å®š</span>
            <span class="character px-2 py-1 rounded" data-char="è‡ª">è‡ª</span>
            <span class="character px-2 py-1 rounded" data-char="æˆ‘">æˆ‘</span>
            <span class="character px-2 py-1 rounded mx-2" data-char="ï¼Œ">ï¼Œ</span>
            <span class="character px-2 py-1 rounded" data-char="æ’">æ’</span>
            <span class="character px-2 py-1 rounded" data-char="é™¤">é™¤</span>
            <span class="character px-2 py-1 rounded" data-char="è¬">è¬</span>
            <span class="character px-2 py-1 rounded" data-char="é›£">é›£</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-teal-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>

        <div class="poem-line bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-xl border-l-4 border-indigo-400 flex items-center justify-between group" data-text="è‡ªç«‹è‡ªå¼·ï¼Œå¥®ç™¼å‘ä¸Š">
          <div class="text-2xl md:text-3xl lg:text-4xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="è‡ª">è‡ª</span>
            <span class="character px-2 py-1 rounded" data-char="ç«‹">ç«‹</span>
            <span class="character px-2 py-1 rounded" data-char="è‡ª">è‡ª</span>
            <span class="character px-2 py-1 rounded" data-char="å¼·">å¼·</span>
            <span class="character px-2 py-1 rounded mx-2" data-char="ï¼Œ">ï¼Œ</span>
            <span class="character px-2 py-1 rounded" data-char="å¥®">å¥®</span>
            <span class="character px-2 py-1 rounded" data-char="ç™¼">ç™¼</span>
            <span class="character px-2 py-1 rounded" data-char="å‘">å‘</span>
            <span class="character px-2 py-1 rounded" data-char="ä¸Š">ä¸Š</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>

        <div class="poem-line bg-gradient-to-r from-pink-50 to-rose-50 p-6 rounded-xl border-l-4 border-pink-400 flex items-center justify-between group" data-text="æŠŠç¬‘å®¹å¯«åœ¨è‡‰ä¸Š">
          <div class="text-3xl md:text-4xl lg:text-5xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="æŠŠ">æŠŠ</span>
            <span class="character px-2 py-1 rounded" data-char="ç¬‘">ç¬‘</span>
            <span class="character px-2 py-1 rounded" data-char="å®¹">å®¹</span>
            <span class="character px-2 py-1 rounded" data-char="å¯«">å¯«</span>
            <span class="character px-2 py-1 rounded" data-char="åœ¨">åœ¨</span>
            <span class="character px-2 py-1 rounded" data-char="è‡‰">è‡‰</span>
            <span class="character px-2 py-1 rounded" data-char="ä¸Š">ä¸Š</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-pink-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>

        <div class="poem-line bg-gradient-to-r from-yellow-50 to-amber-50 p-6 rounded-xl border-l-4 border-yellow-400 flex items-center justify-between group" data-text="è®“æ˜å¤©å……æ»¿å¿«æ¨‚å’Œå¸Œæœ›">
          <div class="text-xl md:text-2xl lg:text-3xl font-medium text-gray-800 flex flex-nowrap gap-1">
            <span class="character px-2 py-1 rounded" data-char="è®“">è®“</span>
            <span class="character px-2 py-1 rounded" data-char="æ˜">æ˜</span>
            <span class="character px-2 py-1 rounded" data-char="å¤©">å¤©</span>
            <span class="character px-2 py-1 rounded" data-char="å……">å……</span>
            <span class="character px-2 py-1 rounded" data-char="æ»¿">æ»¿</span>
            <span class="character px-2 py-1 rounded" data-char="å¿«">å¿«</span>
            <span class="character px-2 py-1 rounded" data-char="æ¨‚">æ¨‚</span>
            <span class="character px-2 py-1 rounded" data-char="å’Œ">å’Œ</span>
            <span class="character px-2 py-1 rounded" data-char="å¸Œ">å¸Œ</span>
            <span class="character px-2 py-1 rounded" data-char="æœ›">æœ›</span>
          </div>
          <svg class="speaker-icon w-8 h-8 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
          <div class="wave-animation"></div>
        </div>
      </div>
    </div>

    <!-- ç¬¬ä¸‰é ï¼šæ¸¬é©— -->
    <div id="page3" class="page bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 md:p-12 hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">ğŸ“ æ ¡æ­Œè©•é‡æ¸¬é©—</h2>
        <p class="text-gray-600">æ¸¬è©¦æ‚¨å°æ ¡æ­Œçš„ç†è§£ç¨‹åº¦</p>
      </div>
      <div id="quizContainer" class="space-y-6"></div>
      <div id="quizResult" class="hidden text-center mt-8">
        <div class="bg-gradient-to-r from-green-100 to-blue-100 p-6 rounded-xl">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">ğŸ‰ æ¸¬é©—å®Œæˆï¼</h3>
          <div id="scoreDisplay" class="text-xl font-medium text-gray-700 mb-4"></div>
          <div id="feedback" class="text-gray-600 mb-6"></div>
          <button id="retakeQuiz" class="control-btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full font-medium">
            é‡æ–°æ¸¬é©—
          </button>
        </div>
      </div>
    </div>

    <!-- é é¢åˆ‡æ› -->
    <div class="flex justify-center gap-4 mt-6">
      <button id="prevPage" class="control-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2.5 rounded-full text-sm font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
        ä¸Šä¸€é 
      </button>
      <span id="pageIndicator" class="flex items-center text-white font-medium">ç¬¬ 1 é  / å…± 3 é </span>
      <button id="nextPage" class="control-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2.5 rounded-full text-sm font-medium flex items-center gap-2">
        ä¸‹ä¸€é 
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>
      </button>
    </div>

    <!-- èªªæ˜ -->
    <div class="text-center mt-8">
      <p class="text-white/70 text-sm mb-2">ğŸ’¡ æç¤ºï¼šè¼•è§¸<strong>å–®å€‹å­—</strong>å¯è†è½æ¸…æ™°çš„å–®å­—ç™¼éŸ³</p>
      <p class="text-white/60 text-xs mb-2">æˆ–è¼•è§¸è©©å¥ç©ºç™½è™•è†è½æ•´å¥æœ—è®€ â€¢ å¹³æ¿ç”¨æˆ¶è«‹å…ˆé»ä¸Šæ–¹ä»»ä¸€æŒ‰éˆ•ä»¥å•Ÿå‹•èªéŸ³</p>
      <p class="text-white/60 text-xs mb-2">ğŸ­ å¯é¸æ“‡ç”·ç”Ÿæˆ–å¥³ç”Ÿç™¼éŸ³ â€¢ å–®å­—æœ—è®€é€Ÿåº¦è¼ƒæ…¢ï¼Œæ›´é©åˆå­¸ç¿’ç™¼éŸ³</p>
      <p id="iosVoiceStatus" class="text-yellow-300 text-xs hidden">ğŸ“± iPhone/iPadï¼šé¦–æ¬¡ä½¿ç”¨è«‹è¼•è§¸ç•«é¢ä¾†å•Ÿå‹•èªéŸ³åŠŸèƒ½</p>
    </div>
  </div>

<script>
/* ========= å¹³æ¿èªéŸ³ç©©å®šï¼šåˆå§‹åŒ–èˆ‡è§£é– ========= */
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
const isAndroid = /Android/.test(navigator.userAgent);
let voicesReady = false;
let availableVoices = [];
let selectedVoice = null;
let gateUnlocked = false;
let speechInitialized = false;
let currentSpeech = null;
let isPlayingAll = false;

/** é¡¯ç¤ºå•Ÿå‹•æµ®å±¤ï¼ˆå¹³æ¿ / æ‰‹æ©Ÿï¼‰ */
function maybeShowVoiceGate(){
  const gate = document.getElementById('voiceGate');
  if (!gate) return;
  if ((isIOS || isAndroid) && !gateUnlocked){
    gate.style.display = 'flex';
  }
}

/** è§£é–èªéŸ³ï¼šéœ€ä½¿ç”¨è€…ä¸€æ¬¡é»æ“Š */
async function unlockSpeechEngine(){
  try{
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(' ');
    u.volume = 0.01; u.rate = 1; u.pitch = 1; u.lang = 'zh-TW';
    window.speechSynthesis.getVoices();
    await awaitVoices(1000);
    window.speechSynthesis.speak(u);
    setTimeout(()=>window.speechSynthesis.cancel(), 120);
    if (window.speechSynthesis.paused) try{ window.speechSynthesis.resume(); }catch(e){}
    speechInitialized = true;
    gateUnlocked = true;
    const gate = document.getElementById('voiceGate');
    if (gate) gate.style.display = 'none';
  }catch(e){
    console.log('unlockSpeechEngine error:', e);
    const gate = document.getElementById('voiceGate');
    if (gate) gate.style.display = 'none';
  }
}

/** ç­‰å¾… voices è¼‰å…¥å®Œæˆ */
function awaitVoices(timeoutMs = 1500){
  return new Promise((resolve)=>{
    const got = window.speechSynthesis.getVoices();
    if (got && got.length > 0){ voicesReady = true; availableVoices = got; resolve(true); return; }
    const t = setTimeout(()=>{ availableVoices = window.speechSynthesis.getVoices(); voicesReady = availableVoices.length>0; resolve(true); }, timeoutMs);
    window.speechSynthesis.onvoiceschanged = () => {
      clearTimeout(t);
      availableVoices = window.speechSynthesis.getVoices();
      voicesReady = availableVoices.length>0;
      resolve(true);
    };
  });
}

/** é¸æ“‡ä¸­æ–‡èªéŸ³ï¼ˆç›¡é‡æŒ‘ç¹ä¸­ï¼Œå…¶æ¬¡ä»»ä¸€ä¸­æ–‡ï¼‰ */
function pickChineseVoice(prefer='female'){
  if (!voicesReady) return null;
  const v = availableVoices;
  const zhPrefer = v.filter(x=> /zh|Hant|TW|HK/i.test(x.lang) || /Chinese|ä¸­æ–‡|Taiwan|Hong Kong/i.test(x.name));
  if (zhPrefer.length===0) return null;
  if (prefer==='male'){
    return zhPrefer.find(x=> /ç”·|Male|Zhiwei|Kangkang/i.test(x.name)) || zhPrefer[1] || zhPrefer[0];
  }else{
    return zhPrefer.find(x=> /å¥³|Female|Mei|Han|Yao|Xiao/i.test(x.name)) || zhPrefer[0];
  }
}

/** å–®ä¸€å…¥å£çš„æœ—è®€å‡½å¼ï¼ˆå«ä¿éšªæ©Ÿåˆ¶èˆ‡å¹³æ¿ä¿®å¾©ï¼‰
 *  âš ï¸ ä¾ä½ çš„éœ€æ±‚ï¼šå°‡æ‰€æœ‰ã€Œé•·ã€åœ¨ç™¼éŸ³æ™‚æ›¿æ›ç‚ºã€ŒæŒã€ï¼Œä»¥ç¢ºä¿å¿µæˆ ã„“ã„¤Ë‡ã€‚
 */
async function speakOnce(text, {rate=0.8, pitch=1.0, isChar=false, element=null}={}){
  if (!('speechSynthesis' in window)) return;

  if (!speechInitialized && (isIOS || isAndroid)){
    await unlockSpeechEngine();
  }
  window.speechSynthesis.getVoices();
  await awaitVoices(1200);

  /* âœ… å­—éŸ³ä¿®æ­£ï¼šæŠŠã€Œé•·ã€å”¸æˆã€ŒæŒã€ */
  if (typeof text === 'string' && text.includes("é•·")) {
    text = text.replace(/é•·/g, "æŒ");
  }

  try{ window.speechSynthesis.cancel(); }catch(e){}
  if (window.speechSynthesis.paused) try{ window.speechSynthesis.resume(); }catch(e){}

  const u = new SpeechSynthesisUtterance( (text||'').trim() || ' ' );
  u.lang = 'zh-TW';
  u.rate = rate; u.pitch = pitch; u.volume = 1.0;
  if (!selectedVoice){
    const prefer = document.querySelector('input[name="voice"]:checked')?.value==='male' ? 'male' : 'female';
    selectedVoice = pickChineseVoice(prefer) || null;
  }
  if (selectedVoice) u.voice = selectedVoice;

  // è¦–è¦ºæ•ˆæœ
  if (element){
    element.classList.add('speaking');
    if (isChar){
      element.style.backgroundColor='#3b82f6';
      element.style.color='#fff';
      element.style.transform='scale(1.2)';
      element.style.boxShadow='0 0 20px rgba(59,130,246,.6)';
    }
  }

  return new Promise((resolve)=>{
    let ended = false;
    const cleanup = ()=>{
      if (ended) return;
      ended = true;
      if (element){
        element.classList.remove('speaking');
        if (isChar){
          element.style.backgroundColor='';
          element.style.color='';
          element.style.transform='';
          element.style.boxShadow='';
        }
      }
      currentSpeech = null;
      resolve();
    };

    // è¶…æ™‚ä¿éšªï¼ˆé¿å…éƒ¨åˆ† Safari ä¸è§¸ç™¼ onendï¼‰
    const safety = setTimeout(()=>{ try{ window.speechSynthesis.cancel(); }catch(e){} cleanup(); }, Math.max(1200, Math.min(10000, String(text).length*500)));

    u.onend = ()=>{ clearTimeout(safety); cleanup(); };
    u.onerror = ()=>{ clearTimeout(safety); cleanup(); };

    currentSpeech = u;
    try{
      window.speechSynthesis.speak(u);
      // è‹¥ 600ms å°šæœªé–‹å§‹èªªè©±ï¼Œé‡è©¦ä¸€æ¬¡
      setTimeout(()=>{
        if (!window.speechSynthesis.speaking){
          try{
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(u);
          }catch(e){}
        }
      }, 600);
    }catch(e){
      clearTimeout(safety);
      cleanup();
    }
  });
}

/* ========= é é¢æ§åˆ¶ ========= */
let currentPage = 1; const totalPages = 3;
const page1 = document.getElementById('page1');
const page2 = document.getElementById('page2');
const page3 = document.getElementById('page3');
const prevBtn = document.getElementById('prevPage');
const nextBtn = document.getElementById('nextPage');
const pageIndicator = document.getElementById('pageIndicator');

function updatePageDisplay(){
  [page1,page2,page3].forEach(p=>p.classList.add('hidden'));
  if (currentPage===1) page1.classList.remove('hidden');
  else if (currentPage===2) page2.classList.remove('hidden');
  else {
    page3.classList.remove('hidden');
    if (!quizInitialized) initializeQuiz();
  }
  prevBtn.disabled = currentPage===1;
  nextBtn.disabled = currentPage===totalPages;
  pageIndicator.textContent = `ç¬¬ ${currentPage} é  / å…± ${totalPages} é `;
}
prevBtn.addEventListener('click', ()=>{ if (currentPage>1){ currentPage--; updatePageDisplay(); }});
nextBtn.addEventListener('click', ()=>{ if (currentPage<totalPages){ currentPage++; updatePageDisplay(); }});
updatePageDisplay();

/* ========= èªéŸ³ UI ç¶å®šï¼ˆpointer äº‹ä»¶ï¼Œæ¡Œé¢/å¹³æ¿çš†å¯ï¼‰ ========= */
const poemLines = document.querySelectorAll('.poem-line');
const characters = document.querySelectorAll('.character');
const playAllBtn = document.getElementById('playAll');
const stopAllBtn = document.getElementById('stopAll');
const voiceOptions = document.querySelectorAll('input[name="voice"]');
const voiceLabels = document.querySelectorAll('.voice-option');

/* å•Ÿå‹•æµ®å±¤ç¶å®š */
document.getElementById('btnUnlockAudio').addEventListener('click', unlockSpeechEngine);
document.addEventListener('DOMContentLoaded', ()=>{
  window.speechSynthesis.getVoices();
  awaitVoices(1000).then(()=>{
    voicesReady = true;
    const prefer = document.querySelector('input[name="voice"]:checked')?.value==='male' ? 'male' : 'female';
    selectedVoice = pickChineseVoice(prefer);
  });
  maybeShowVoiceGate();
  if (isIOS) document.getElementById('iosVoiceStatus')?.classList.remove('hidden');
});

/* èªéŸ³é¸é … */
voiceOptions.forEach((opt, idx)=>{
  opt.addEventListener('change', ()=>{
    const prefer = opt.value==='male' ? 'male' : 'female';
    selectedVoice = pickChineseVoice(prefer);
    voiceLabels.forEach(l=>{ l.classList.remove('border-pink-300','border-blue-300'); l.classList.add('border-transparent'); });
    if (opt.value==='female'){ voiceLabels[0].classList.replace('border-transparent','border-pink-300'); }
    else { voiceLabels[1].classList.replace('border-transparent','border-blue-300'); }
  });
});

/* å–®å­—æœ—è®€ */
characters.forEach(char=>{
  const text = char.getAttribute('data-char') || char.textContent.trim();

  char.addEventListener('pointerenter', (e)=>{
    if (e.pointerType==='mouse' && !isPlayingAll){
      speakOnce(text,{rate:.4,pitch:1.1,isChar:true,element:char});
    }
  });

  char.addEventListener('pointerdown', async (e)=>{
    e.preventDefault();
    if (!isPlayingAll){
      await speakOnce(text,{rate:.4,pitch:1.1,isChar:true,element:char});
    }
  });
});

/* æ•´å¥æœ—è®€ */
poemLines.forEach(line=>{
  const text = line.getAttribute('data-text') || line.textContent.replace(/\s+/g,'').trim();

  line.addEventListener('pointerenter',(e)=>{
    if (e.pointerType==='mouse' && !isPlayingAll && !e.target.classList.contains('character')){
      speakOnce(text,{rate:.7,pitch:1.0,isChar:false,element:line});
    }
  });

  line.addEventListener('pointerdown', async (e)=>{
    if (!e.target.classList.contains('character')){
      e.preventDefault();
      if (!isPlayingAll){
        await speakOnce(text,{rate:.7,pitch:1.0,isChar:false,element:line});
      }
    }
  });
});

/* æ’­æ”¾å…¨éƒ¨ */
playAllBtn.addEventListener('click', async ()=>{
  if (isPlayingAll) return;
  isPlayingAll = true;
  try{ window.speechSynthesis.cancel(); }catch(e){}
  const allTexts = [
    "åŒ—å‹¢æ©‹é ­é£„æ›¸é¦™",
    "å¾Œé¾æºªç•”æ­Œè²å–¨",
    "é€™è£¡æ˜¯æˆ‘å€‘æˆé•·çš„æ–ç±ƒ",
    "æ´‹æº¢è‘—æ„›çš„èŠ¬èŠ³",
    "è‚¯å®šè‡ªæˆ‘ï¼Œæ’é™¤è¬é›£",
    "è‡ªç«‹è‡ªå¼·ï¼Œå¥®ç™¼å‘ä¸Š",
    "æŠŠç¬‘å®¹å¯«åœ¨è‡‰ä¸Š",
    "è®“æ˜å¤©å……æ»¿å¿«æ¨‚å’Œå¸Œæœ›"
  ];
  let i=0;
  while(i<allTexts.length && isPlayingAll){
    const pageShould = (i<4)?1:2;
    if (currentPage!==pageShould){ currentPage = pageShould; updatePageDisplay(); }
    const currentLines = document.querySelectorAll('.page:not(.hidden) .poem-line');
    const lineIndex = (i<4)? i : i-4;
    const lineEl = currentLines[lineIndex];
    await speakOnce(allTexts[i], {rate:.7,pitch:1.0,isChar:false,element:lineEl});
    i++;
    if (!isPlayingAll) break;
    await new Promise(r=>setTimeout(r,300));
  }
  isPlayingAll = false;
});
stopAllBtn.addEventListener('click', ()=>{
  isPlayingAll = false;
  try{ window.speechSynthesis.cancel(); }catch(e){}
});

/* ========= æ¸¬é©—å€ ========= */
let quizInitialized=false,currentQuestionIndex=0,score=0,userAnswers=[];
const quizQuestions=[
  {question:"æ ¡æ­Œç¬¬ä¸€å¥æ˜¯ä»€éº¼ï¼Ÿ",options:["åŒ—å‹¢æ©‹é ­é£„æ›¸é¦™","å¾Œé¾æºªç•”æ­Œè²å–¨","é€™è£¡æ˜¯æˆ‘å€‘æˆé•·çš„æ–ç±ƒ","æ´‹æº¢è‘—æ„›çš„èŠ¬èŠ³"],correct:0},
  {question:"ã€Œæˆé•·ã€çš„ã€Œé•·ã€å­—æ­£ç¢ºç™¼éŸ³æ˜¯ï¼Ÿ",options:["ã„”ã„¤ËŠ","ã„“ã„¤Ë‡","ã„”ã„¤Ë‡","ã„“ã„¤ËŠ"],correct:1},
  {question:"æ ¡æ­Œä¸­æåˆ°å“ªæ¢æºªï¼Ÿ",options:["æ·¡æ°´æ²³","å¾Œé¾æºª","å¤§ç”²æºª","é ­å‰æºª"],correct:1},
  {question:"æ ¡æ­Œä¸­ã€ŒæŠŠç¬‘å®¹å¯«åœ¨è‡‰ä¸Šã€çš„ä¸‹ä¸€å¥æ˜¯ï¼Ÿ",options:["æ´‹æº¢è‘—æ„›çš„èŠ¬èŠ³","è‡ªç«‹è‡ªå¼·ï¼Œå¥®ç™¼å‘ä¸Š","è®“æ˜å¤©å……æ»¿å¿«æ¨‚å’Œå¸Œæœ›","è‚¯å®šè‡ªæˆ‘ï¼Œæ’é™¤è¬é›£"],correct:2},
  {question:"æ ¡æ­Œä¸­å¼·èª¿çš„ç²¾ç¥åŒ…æ‹¬å“ªäº›ï¼Ÿ",options:["è‡ªç«‹è‡ªå¼·","è‚¯å®šè‡ªæˆ‘","å¥®ç™¼å‘ä¸Š","ä»¥ä¸Šçš†æ˜¯"],correct:3},
  {question:"æ ¡æ­Œç¬¬äºŒå¥ã€Œå¾Œé¾æºªç•”æ­Œè²å–¨ã€ä¸­çš„ã€Œå–¨ã€å­—æ˜¯ä»€éº¼æ„æ€ï¼Ÿ",options:["éŸ¿äº®æ¸…è„†","æº«æŸ”è¼•æŸ”","ä½æ²‰åšé‡","æ–·æ–·çºŒçºŒ"],correct:0},
  {question:"æ ¡æ­Œä¸­ã€ŒåŒ—å‹¢æ©‹é ­ã€æŒ‡çš„æ˜¯ä»€éº¼åœ°æ–¹ï¼Ÿ",options:["å­¸æ ¡é™„è¿‘çš„åœ°æ¨™","è‹—æ —çš„è‘—åæ™¯é»","æ ¡åœ’å…§çš„å»ºç¯‰","æ­·å²å¤è¹Ÿåç¨±"],correct:0},
  {question:"ã€Œæ´‹æº¢è‘—æ„›çš„èŠ¬èŠ³ã€é€™å¥è©±è¡¨é”äº†ä»€éº¼æ„æ€ï¼Ÿ",options:["æ ¡åœ’è£¡èŠ±é¦™æ’²é¼»","å……æ»¿é—œæ„›çš„æ°›åœ","ç©ºæ°£å¾ˆæ¸…æ–°","æœ‰å¾ˆå¤šé¦™æ°´å‘³"],correct:1},
  {question:"æ ¡æ­Œä¸­ã€Œè‚¯å®šè‡ªæˆ‘ï¼Œæ’é™¤è¬é›£ã€é«”ç¾äº†ä»€éº¼æ•™è‚²ç†å¿µï¼Ÿ",options:["ç«¶çˆ­è‡³ä¸Š","è‡ªä¿¡èˆ‡å …æŒ","æœå¾è½è©±","éš¨é‡è€Œå®‰"],correct:1},
  {question:"æ•´é¦–æ ¡æ­Œå‚³é”çš„æ ¸å¿ƒç²¾ç¥æ˜¯ä»€éº¼ï¼Ÿ",options:["åŠªåŠ›è®€æ›¸è€ƒé«˜åˆ†","ç©æ¥µæ¨‚è§€é¢å°äººç”Ÿ","åš´æ ¼éµå®ˆæ ¡è¦","åŸ¹é¤Šè—è¡“æ‰èƒ½"],correct:1}
];

function initializeQuiz(){
  quizInitialized=true;currentQuestionIndex=0;score=0;userAnswers=[];
  document.getElementById('quizContainer').classList.remove('hidden');
  document.getElementById('quizResult').classList.add('hidden');
  showQuestion();
}

async function speakQuizText(text){ await speakOnce(text,{rate:.85,pitch:1.0}); }

function showQuestion(){
  const quizContainer=document.getElementById('quizContainer');
  const q=quizQuestions[currentQuestionIndex];
  quizContainer.innerHTML = `
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl border-l-4 border-blue-400">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-gray-800">é¡Œç›® ${currentQuestionIndex+1} / ${quizQuestions.length}</h3>
        <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">é€²åº¦: ${Math.round((currentQuestionIndex/quizQuestions.length)*100)}%</div>
      </div>
      <div class="flex items-center gap-3 mb-6">
        <p class="text-lg text-gray-700 flex-1">${q.question}</p>
        <button id="speakQuestion" class="control-btn bg-purple-500 hover:bg-purple-600 text-white p-2 rounded-full">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.793L4.617 14H2a1 1 0 01-1-1V7a1 1 0 011-1h2.617l3.766-2.793a1 1 0 011.617.793z" clip-rule="evenodd"/><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"/></svg>
        </button>
      </div>
      <div class="space-y-3">
        ${q.options.map((opt,idx)=>`
          <button class="quiz-option w-full text-left p-4 bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-lg transition-all duration-200 font-medium text-gray-700" data-index="${idx}" data-option-text="${opt}">
            <span class="inline-block w-8 h-8 bg-gray-100 text-gray-600 rounded-full text-center leading-8 mr-3 text-sm font-bold">${String.fromCharCode(65+idx)}</span>
            ${opt}
          </button>
        `).join('')}
      </div>
    </div>
  `;
  setTimeout(()=>speakQuizText(q.question), 300);
  document.getElementById('speakQuestion').addEventListener('click', ()=>speakQuizText(q.question));

  quizContainer.querySelectorAll('.quiz-option').forEach(btn=>{
    const optText = btn.getAttribute('data-option-text');
    btn.addEventListener('pointerenter',(e)=>{ if(e.pointerType==='mouse') speakQuizText(optText); });
    btn.addEventListener('pointerdown', async (e)=>{
      e.preventDefault();
      await speakQuizText(optText);
      setTimeout(()=> selectAnswer(parseInt(btn.getAttribute('data-index'))), 250);
    });
  });
}

function playCorrectSound(){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = ctx.createOscillator(), g=ctx.createGain();
  osc.connect(g); g.connect(ctx.destination);
  const t=ctx.currentTime;
  g.gain.setValueAtTime(0.25,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.5);
  osc.frequency.setValueAtTime(523.25,t);
  osc.frequency.setValueAtTime(659.25,t+0.1);
  osc.frequency.setValueAtTime(783.99,t+0.2);
  osc.start(t); osc.stop(t+0.5);
}
function playIncorrectSound(){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = ctx.createOscillator(), g=ctx.createGain();
  osc.connect(g); g.connect(ctx.destination);
  const t=ctx.currentTime;
  g.gain.setValueAtTime(0.25,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.4);
  osc.frequency.setValueAtTime(220,t);
  osc.frequency.setValueAtTime(196,t+0.15);
  osc.start(t); osc.stop(t+0.4);
}

function selectAnswer(sel){
  const q=quizQuestions[currentQuestionIndex];
  userAnswers[currentQuestionIndex]=sel;
  const opts=document.querySelectorAll('.quiz-option');
  opts.forEach((o,idx)=>{
    o.disabled=true; o.classList.remove('hover:bg-blue-50','hover:border-blue-300');
    if (idx===q.correct){ o.classList.add('bg-green-100','border-green-400','text-green-800'); o.querySelector('span').classList.add('bg-green-200','text-green-800'); }
    else if (idx===sel && sel!==q.correct){ o.classList.add('bg-red-100','border-red-400','text-red-800'); o.querySelector('span').classList.add('bg-red-200','text-red-800'); }
  });
  if (sel===q.correct){ score++; playCorrectSound(); setTimeout(()=>speakQuizText("ç­”å°äº†ï¼å¾ˆæ£’ï¼"), 200); }
  else { playIncorrectSound(); setTimeout(()=>speakQuizText("ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š"+q.options[q.correct]), 200); }
  setTimeout(()=>{
    currentQuestionIndex++;
    if (currentQuestionIndex<quizQuestions.length) showQuestion(); else showResult();
  }, 1600);
}

function showResult(){
  const quizContainer=document.getElementById('quizContainer');
  const quizResult=document.getElementById('quizResult');
  const scoreDisplay=document.getElementById('scoreDisplay');
  const feedback=document.getElementById('feedback');
  quizContainer.classList.add('hidden'); quizResult.classList.remove('hidden');
  const pct=Math.round((score/quizQuestions.length)*100);
  scoreDisplay.textContent=`æ‚¨çš„å¾—åˆ†ï¼š${score} / ${quizQuestions.length} (${pct}%)`;
  let text='',emoji='';
  if (pct>=90){ emoji='ğŸ†'; text='å¤ªæ£’äº†ï¼æ‚¨å°æ ¡æ­Œéå¸¸ç†Ÿæ‚‰ï¼'; }
  else if (pct>=70){ emoji='ğŸ‘'; text='å¾ˆå¥½ï¼æ‚¨å°æ ¡æ­Œæœ‰ä¸éŒ¯çš„ç†è§£ï¼'; }
  else if (pct>=50){ emoji='ğŸ“š'; text='é‚„ä¸éŒ¯ï¼å»ºè­°å†å¤šè½å¹¾éæ ¡æ­ŒåŠ æ·±å°è±¡ã€‚'; }
  else { emoji='ğŸ’ª'; text='ç¹¼çºŒåŠªåŠ›ï¼å¤šç·´ç¿’æœ—è®€æ ¡æ­Œæœƒæœ‰å¹«åŠ©çš„ã€‚'; }
  feedback.innerHTML=`${emoji} ${text}`;
}
document.addEventListener('DOMContentLoaded', ()=>{
  const r=document.getElementById('retakeQuiz');
  if (r) r.addEventListener('click', ()=>{ quizInitialized=false; initializeQuiz(); });
});
</script>
</body>
</html>
